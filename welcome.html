<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Page</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="welcome-container">
        <div class="profile-pic-container">
            <img src="profile.png" alt="Profile Picture" class="profile-pic">
        </div>
        <h1 class="welcome-message">Welcome, <span id="realname">[Your Name]</span>!</h1>
        <p id="data-count-message">Loading data...</p>
        <button class="entry-button">Entry Data</button>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore-compat.js"></script>

    <!-- JavaScript to fetch realname from cookies and Firestore data -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCBF2gLqtLL6msiugN7fuMlMK5278rJpsQ",
            authDomain: "quickcount-9e634.firebaseapp.com",
            projectId: "quickcount-9e634",
            storageBucket: "quickcount-9e634.appspot.com",
            messagingSenderId: "855202720175",
            appId: "1:855202720175:web:cc9ead847ec6c67b70275a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Function to get cookie value by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // Get the realname cookie saved after login
        const realname = getCookie('realname');
        console.log('Realname from cookie:', realname);  // Log to check if realname is retrieved correctly

        // If the realname cookie is found, display it on the page
        if (realname) {
            document.getElementById('realname').textContent = realname;

            // Fetch data from Firestore where the realname matches
            db.collection('suara').where('koordinator_saksi', '==', realname)
                .get()
                .then((querySnapshot) => {
                    const dataCount = querySnapshot.size;
                    document.getElementById('data-count-message').textContent = `You have submitted ${dataCount} entries.`;
                })
                .catch((error) => {
                    console.error('Error fetching data:', error);
                    document.getElementById('data-count-message').textContent = 'Error loading data.';
                });
        } else {
            // If no cookie is found, redirect back to the login page
            window.location.href = "index.html";
        }
    </script>
</body>
</html>
